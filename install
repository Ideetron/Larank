#!/bin/bash

# start me like: install lorank8v1 1.0.1
# from the directory you cloned the repro Lorank in.

# Control of urs leds
function led_on    { pushd /sys/class/leds/beaglebone\:green\:usr$1; echo none  > trigger; echo 1 > brightness; popd; }
function led_off   { pushd /sys/class/leds/beaglebone\:green\:usr$1; echo none  > trigger; echo 0 > brightness; popd; }
function led_flash { pushd /sys/class/leds/beaglebone\:green\:usr$1; echo timer > trigger; echo 50 > delay_on; echo 100 > delay_off; popd; }
function led_blank { off 0; off 1; off 2; off 3; }
function led_error { flash 0; flash 1; flash 2; flash 3; }

HWTARGET=$1
SWVERSION=$2

# report progress
led_blank
led_flash 1
sleep 1

# Set the Lorank installation software to the correct release.
pushd Lorank
if [[ $SWVERSION != "" ]]; then git checkout -q Lorank_v$SWVERSION; fi
popd

# Start the platform dependent installation for this release.
./Lorank/$HWTARGET/install $SWVERSION

# We are done, check if we must report an error, if not terminate. 
if [ $? -ne 0 ]; 
then
  led_error
else 
  shutdown -h now
fi

